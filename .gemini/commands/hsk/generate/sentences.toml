# /hsk:generate:sentences — Generate HSK grammar exercise sentences

description = "Generate exercise sentences markdown for an HSK grammar point (parseable for TSV conversion)"

prompt = """
@{linguistics/llm/system-prompt.md}

You are generating exercise sentences for Chinese grammar practice. Your output will be a markdown file that can be parsed by a script to generate TSV for Anki import.

## Task

Generate exercises for the grammar point: `<args>`

The first argument is the **word** (e.g., 似乎, 对于, 岂不).
The second argument (optional) is the **number of exercises** to generate (default: 5).

## Step 1: Find the Grammar File

Search for the grammar explanation file matching the word in:
```text
linguistics/hsk/grammar/*-<WORD>.md
```

Examples:
- `linguistics/hsk/grammar/HSK4-11-似乎.md` for 似乎
- `linguistics/hsk/grammar/NON-HSK-岂不.md` for 岂不

If the file is not found, **STOP and inform the user** that they need to run `/hsk:generate:explain <word>` first.

## Step 2: Find the Character Breakdown

Look for the character breakdown at:
```text
linguistics/hsk/grammar/characters/<WORD>.md
```

Note if it exists or not.

## Step 3: Extract Metadata

From the grammar file name, extract:
- **GrammarPoint**: e.g., "四11" from "HSK4-11-似乎.md" or "NON-HSK" from "NON-HSK-岂不.md"
- **Word**: the target word (e.g., 似乎)
- **Pinyin**: extract from the grammar file's title or first paragraph

## Step 4: Generate Example Sentences

Create exercise sentences following these rules:

1. **NO DUPLICATES**: Do NOT use any sentences that already appear as examples in the grammar explanation file
2. **Variety**: Each sentence should demonstrate the grammar point in a different context
3. **Natural**: Use realistic, everyday scenarios
4. **Appropriate level**: Match HSK level vocabulary
5. **Focus**: The sentences should demonstrate the word in the specific grammar point context

### Sentence Requirements

- Chinese sentence: natural usage of the grammar point
- Sentence pinyin: full pinyin with tone marks
- English translation: natural English with the equivalent expression identified

## Step 5: Output Markdown File

Create the markdown file at:
```text
linguistics/hsk/grammar/sentences/<GRAMMAR_FILENAME>.md
```

Where `<GRAMMAR_FILENAME>` matches the grammar file without `.md`.
Example: `linguistics/hsk/grammar/sentences/HSK4-11-似乎.md`

### Markdown Format

```markdown
# <Word> (<Pinyin>) — <GrammarPoint>

- **Grammar**: [<GRAMMAR_FILENAME>](../<GRAMMAR_FILENAME>.md)
- **Characters**: [<WORD>](../characters/<WORD>.md)

## Sentence Exercises

- Chinese sentence with ==highlight==
  - *Pinyin with tone marks*
  - English translation with ==highlight==
```

### Structure

Each sentence is a nested list:
- **Top level**: Chinese sentence with highlighted grammar word
- **First sub-item**: Pinyin in italics
- **Second sub-item**: English translation with highlighted equivalent

### Highlighting

**CRITICAL**: Use `==text==` (double equals) for highlights, NOT `**text**` (bold).

The `==text==` is a markdown extension for highlighting. This is **NOT** the same as bold.

- ✅ CORRECT: `==似乎==` (double equals signs)
- ❌ WRONG: `**似乎**` (asterisks for bold)

Apply highlights:
- In Chinese: wrap the target grammar word with `==word==`
- In Pinyin: wrap the pinyin of the target word with `==pinyin==`
- In English: wrap the corresponding translation with `==equivalent==`

### Example Output

```markdown
# 似乎 (sìhū) — 四11

- **Grammar**: [HSK4-11-似乎](../HSK4-11-似乎.md)
- **Characters**: [似乎](../characters/似乎.md)

## Sentence Exercises

- 天==似乎==要下雨了。
  - *Tiān ==sìhū== yào xiàyǔ le.*
  - It ==seems like== it's going to rain.

- 他==似乎==不太想去。
  - *Tā ==sìhū== bù tài xiǎng qù.*
  - He doesn't ==seem== to want to go.

- 她==似乎==生气了。
  - *Tā ==sìhū== shēngqì le.*
  - She ==seems== to be angry.
```

### Important Rules

1. **Inline highlights**: Use `==text==` syntax for highlights in Chinese, Pinyin, and English.
2. **One highlight per sentence**: Each sentence should have exactly one highlighted portion in Chinese and one in English.
3. **Consistent structure**: Always use the nested list format (Chinese → Pinyin → English).
4. **Italicize pinyin**: Wrap pinyin in `*asterisks*` for italics.
5. **Relative links**: Use relative paths for the Grammar and Characters links.

## Quality Checks

Before outputting:
1. Verify the grammar file exists
2. Ensure all sentences are unique (not from the grammar explanation)
3. Confirm each Chinese sentence has exactly one `==highlighted==` portion (NOT **bold**)
4. Confirm each Pinyin has exactly one `==highlighted==` portion (NOT **bold**)
5. Confirm each English sentence has exactly one `==highlighted==` portion (NOT **bold**)

## Validation

After creating the file, run the validation command:
```bash
./zh-learn.sh export-sentences <created-file-path> --dry-run
```

If validation fails with "Chinese sentence must contain highlight markers", you used `**bold**` instead of `==highlight==`. Fix the file and re-validate.

## Output Summary

After creating the file and validating, report:
- File path created
- Number of exercises generated
- The GrammarPoint ID used
- Whether character breakdown exists
- Validation result (pass/fail)
"""
